<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marvin - Smart AI Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <style>
        :root {
            --primary: #00c6ff;
            --secondary: #0072ff;
            --accent: #00ffcc;
            --dark: #0a0e17;
            --darker: #050a14;
            --light: #e6f7ff;
            --card-bg: rgba(10, 14, 23, 0.8);
            --card-border: rgba(0, 198, 255, 0.3);
            --glow: 0 0 15px rgba(0, 198, 255, 0.7);
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            opacity: 0;
            animation: fadeIn 1.5s ease-out forwards;
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Background Animation */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 114, 255, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Header Section */
        #header {
            text-align: center;
            padding: 2rem 1rem;
            position: relative;
            margin-bottom: 2rem;
            opacity: 0;
            animation: slideDown 1s ease-out 0.5s forwards;
        }

        @keyframes slideDown {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--glow);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            background: conic-gradient(transparent, var(--accent), transparent);
            animation: rotate 3s linear infinite;
        }

        .logo-inner {
            width: 110px;
            height: 110px;
            background: var(--dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            overflow: hidden;
        }

        .logo-inner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .tagline {
            font-size: 1.2rem;
            color: rgba(230, 247, 255, 0.8);
            font-weight: 300;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            flex: 1;
            margin-bottom: 100px;
        }

        /* Sidebar */
        .sidebar {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            opacity: 0;
            animation: slideInLeft 1s ease-out 0.8s forwards;
            display: flex;
            flex-direction: column;
            height: 80vh;
            overflow: hidden;
        }

        @keyframes slideInLeft {
            0% { transform: translateX(-50px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        .sidebar-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* Hide scrollbar but keep functionality */
        .sidebar-content::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        .status-card {
            background: linear-gradient(135deg, rgba(0, 198, 255, 0.1), rgba(0, 114, 255, 0.1));
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            border: 1px solid rgba(0, 198, 255, 0.2);
        }

        .status-title {
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .status-value {
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .action-btn {
            background: rgba(0, 198, 255, 0.1);
            border: 1px solid rgba(0, 198, 255, 0.3);
            border-radius: 12px;
            padding: 1rem;
            color: var(--light);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80px;
        }

        .action-btn i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .action-btn:hover {
            background: rgba(0, 198, 255, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 198, 255, 0.4);
        }

        .features-section {
            margin-top: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .features-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .features-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* Hide scrollbar but keep functionality */
        .features-list::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        .feature-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: rgba(0, 198, 255, 0.05);
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
        }

        .feature-item:hover {
            background: rgba(0, 198, 255, 0.1);
            transform: translateX(5px);
        }

        .feature-item i {
            color: var(--accent);
            margin-right: 0.8rem;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .feature-text {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Main Content */
        .main-content {
            opacity: 0;
            animation: slideInRight 1s ease-out 1s forwards;
            display: flex;
            flex-direction: column;
            height: 80vh;
        }

        @keyframes slideInRight {
            0% { transform: translateX(50px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        .interaction-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .interaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .interaction-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .mode-toggle {
            display: flex;
            background: rgba(0, 198, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
        }

        .mode-btn {
            padding: 8px 15px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .mode-btn.active {
            background: rgba(0, 198, 255, 0.3);
            color: var(--accent);
        }

        .conversation-area {
            background: rgba(10, 14, 23, 0.5);
            border-radius: 15px;
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
            border: 1px solid rgba(0, 198, 255, 0.2);
            display: flex;
            flex-direction: column;
            margin-bottom: 1.5rem;
            max-height: 400px;
        }

        /* Hide scrollbar but keep functionality */
        .conversation-area::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            animation: messageAppear 0.3s ease-out;
            max-width: 85%;
            word-wrap: break-word;
            position: relative;
        }

        @keyframes messageAppear {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background: rgba(0, 198, 255, 0.1);
            border-left: 3px solid var(--primary);
            align-self: flex-end;
            margin-left: auto;
        }

        .marvin-message {
            background: rgba(0, 255, 204, 0.1);
            border-left: 3px solid var(--accent);
            align-self: flex-start;
            margin-right: auto;
        }

        .message-sender {
            font-weight: 600;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        .user-message .message-sender {
            color: var(--primary);
        }

        .marvin-message .message-sender {
            color: var(--accent);
        }

        .message-content {
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Fixed Input Area */
        .input-area {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            min-height: 70px;
        }

        #command-input {
            flex: 1;
            background: rgba(10, 14, 23, 0.7);
            border: 1px solid rgba(0, 198, 255, 0.3);
            border-radius: 12px;
            padding: 12px 15px;
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
            min-height: 50px;
            max-height: 120px;
            resize: none;
            overflow-y: auto;
            line-height: 1.4;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-family: 'Inter', sans-serif;
        }

        #command-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 198, 255, 0.2);
        }

        /* Style scrollbar for textarea */
        #command-input::-webkit-scrollbar {
            width: 6px;
        }

        #command-input::-webkit-scrollbar-track {
            background: rgba(0, 198, 255, 0.1);
            border-radius: 3px;
        }

        #command-input::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        #speak-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            height: 50px;
            flex-shrink: 0;
        }

        #speak-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 198, 255, 0.4);
        }

        #speak-btn.listening {
            background: linear-gradient(135deg, #ff3366, #ff0066);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 51, 102, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 51, 102, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 51, 102, 0); }
        }

        /* Webcam Section */
        #webcam-container {
            position: relative;
            margin-top: 1rem;
            border-radius: 15px;
            overflow: hidden;
            display: none;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
        }

        #webcam {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 198, 255, 0.5);
            display: block;
        }

        #webcam-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        .webcam-controls {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 50px;
        }

        .webcam-btn {
            background: rgba(0, 198, 255, 0.3);
            border: 1px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
        }

        .webcam-btn:hover {
            background: rgba(0, 198, 255, 0.5);
            transform: scale(1.1);
        }

        .detection-info {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            max-width: 200px;
        }

        .nav-btn {
            background: rgba(0, 198, 255, 0.1);
            border: 1px solid rgba(0, 198, 255, 0.3);
            border-radius: 10px;
            padding: 0.8rem 1.5rem;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover {
            background: rgba(0, 198, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 198, 255, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 968px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
                height: auto;
                max-height: 50vh;
            }
            
            .main-content {
                order: 1;
                height: 60vh;
            }
            
            h1 {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 600px) {
            .input-area {
                flex-direction: column;
                align-items: stretch;
            }
            
            #speak-btn {
                width: 100%;
                justify-content: center;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .logo-inner {
                width: 90px;
                height: 90px;
            }
            
            .features-list {
                max-height: 200px;
            }
            
            .message {
                max-width: 95%;
            }
            
            .webcam-controls {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
            }
        }

        .upload-area:hover {
            background: rgba(0, 198, 255, 0.1);
            transform: translateY(-2px);
        }

        #detect-objects-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 8px;
            padding: 10px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        #detect-objects-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 198, 255, 0.4);
        }

        .highlight-feature {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2)) !important;
            border: 2px solid gold !important;
            position: relative;
        }
        /* Navigation Bar Styles */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(5, 10, 20, 0.7);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(0, 198, 255, 0.2);
    z-index: 1000;
    padding: 0.8rem 0;
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-logo {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.logo-small {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
}

.logo-small::before {
    content: '';
    position: absolute;
    width: 150%;
    height: 150%;
    background: conic-gradient(transparent, var(--accent), transparent);
    animation: rotate 3s linear infinite;
}

.logo-small-inner {
    width: 36px;
    height: 36px;
    background: var(--dark);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
    overflow: hidden;
}

.nav-title {
    font-size: 1.3rem;
    font-weight: 700;
    background: linear-gradient(to right, var(--primary), var(--accent));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.nav-links {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.2rem;
    background: rgba(0, 198, 255, 0.1);
    border: 1px solid rgba(0, 198, 255, 0.2);
    border-radius: 8px;
    color: var(--light);
    text-decoration: none;
    transition: var(--transition);
    font-weight: 500;
    font-size: 0.9rem;
}

.nav-link:hover {
    background: rgba(0, 198, 255, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 198, 255, 0.3);
}

.nav-link.active {
    background: rgba(0, 198, 255, 0.3);
    color: var(--accent);
    border-color: var(--primary);
}

.nav-link i {
    font-size: 1rem;
}

/* Adjust main header to account for fixed navbar */
#header {
    margin-top: 80px; /* Add space for fixed navbar */
    text-align: center;
    padding: 2rem 1rem;
    position: relative;
    margin-bottom: 2rem;
    opacity: 0;
    animation: slideDown 1s ease-out 0.5s forwards;
}

@media (max-width: 768px) {
    .nav-container {
        padding: 0 1rem;
    }
    
    .nav-links {
        gap: 0.5rem;
    }
    
    .nav-link {
        padding: 0.5rem 0.8rem;
        font-size: 0.8rem;
    }
    
    .nav-link span {
        display: none; /* Hide text on very small screens */
    }
    
    .nav-title {
        font-size: 1.1rem;
    }
}

/* Pro Mode Container - Far Right */
   .pro-mode-container {
    position: fixed;
    top: 15px;
    right: 30px;
    z-index: 1001;
    display: flex;
    align-items: center;
}

.pro-mode-toggle {
   display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.4rem 0.8rem;
    background: rgba(0, 198, 255, 0.08);
    border: 1px solid rgba(0, 198, 255, 0.25);
    border-radius: 20px;
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.toggle-checkbox {
    display: none;
}

.toggle-label {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    cursor: pointer;
    color: var(--light);
    font-weight: 600;
    transition: var(--transition);
}

.toggle-slider {
     position: relative;
    width: 40px;
    height: 20px;
    background: rgba(0, 198, 255, 0.2);
    border: 1px solid rgba(0, 198, 255, 0.4);
    border-radius: 20px;
    transition: var(--transition);
    overflow: hidden;
}

.toggle-knob {
     position: absolute;
    top: 2px;
    left: 2px;
    width: 14px;
    height: 14px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.toggle-knob .pro-icon {
    color: white;
    font-size: 0.5rem;
    transition: var(--transition);
}

.toggle-checkbox:checked + .toggle-label .toggle-slider {
    background: rgba(139, 0, 0, 0.3);
    border-color: #8B0000;
    box-shadow: none; /* Remove pulsing glow */
}

.toggle-checkbox:checked + .toggle-label .toggle-knob {
    left: calc(100% - 16px);
    background: linear-gradient(135deg, #4A0000, #8B0000);
    transform: scale(1.1) rotate(180deg);
}

.toggle-checkbox:checked + .toggle-label .toggle-text {
    color: #FF0000;
    text-shadow: none; /* Remove glow */
    font-weight: 700;
}

.toggle-checkbox:checked + .toggle-label .pro-icon {
    color: #fff;
}

.toggle-text {
     font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.3px;
    transition: var(--transition);
    text-transform: uppercase;
}

/* Pro Mode Global Theme */
body.pro-mode-active {
    --primary: #8B0000;
    --secondary: #4A0000;
    --accent: #FF0000;
    --card-border: rgba(139, 0, 0, 0.5);
    --glow: 0 0 20px rgba(139, 0, 0, 0.5);
}

body.pro-mode-active .bg-animation::before {
    background: radial-gradient(circle, rgba(75, 0, 0, 0.15) 0%, transparent 70%);
    animation: rotate 30s linear infinite; /* Back to slower rotation */
}

body.pro-mode-active .logo::before {
    background: conic-gradient(transparent, #8B0000, transparent);
    animation: rotate 3s linear infinite; /* Normal speed */
}

body.pro-mode-active .nav-link.active {
    background: rgba(139, 0, 0, 0.3);
    border-color: #8B0000;
}

body.pro-mode-active .nav-link:hover {
    background: rgba(139, 0, 0, 0.2);
    box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
}

body.pro-mode-active .action-btn:hover {
    background: rgba(139, 0, 0, 0.2);
    box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
}

body.pro-mode-active .feature-item:hover {
    background: rgba(139, 0, 0, 0.1);
}

body.pro-mode-active #speak-btn {
    background: linear-gradient(135deg, #8B0000, #4A0000);
}

body.pro-mode-active #speak-btn:hover {
    box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4);
}

body.pro-mode-active .logo-inner img {
    filter: sepia(100%) saturate(300%) hue-rotate(-50deg) brightness(0.8);
}

body.pro-mode-active .conversation-area {
    background: rgba(75, 0, 0, 0.2);
    border: 1px solid rgba(139, 0, 0, 0.3);
}

body.pro-mode-active .user-message {
    background: rgba(139, 0, 0, 0.15);
    border-left: 3px solid #8B0000;
}

body.pro-mode-active .marvin-message {
    background: rgba(255, 0, 0, 0.1);
    border-left: 3px solid #FF0000;
}

body.pro-mode-active .user-message .message-sender {
    color: #8B0000;
}

body.pro-mode-active .marvin-message .message-sender {
    color: #FF0000;
}

body.pro-mode-active .input-area {
    background: rgba(75, 0, 0, 0.3);
}

body.pro-mode-active #command-input {
    background: rgba(10, 14, 23, 0.9);
    border: 1px solid rgba(139, 0, 0, 0.4);
}

body.pro-mode-active #command-input:focus {
    border-color: #8B0000;
    box-shadow: 0 0 0 2px rgba(139, 0, 0, 0.2);
}

body.pro-mode-active .navbar {
    background: rgba(75, 0, 0, 0.3);
    border-bottom: 1px solid rgba(28, 0, 0, 0.4);
}

body.pro-mode-active .logo-small {
    background: linear-gradient(135deg, #8B0000, #4A0000);
}

body.pro-mode-active .logo-small::before {
    background: conic-gradient(transparent, #FF0000, transparent);
}

body.pro-mode-active .logo-small-inner {
    border: 1px solid #8B0000;
}

body.pro-mode-active .nav-title {
    background: linear-gradient(to right, #8B0000, #FF0000);
    -webkit-background-clip: text;
    background-clip: text;
}

body.pro-mode-active .nav-link {
    background: rgba(139, 0, 0, 0.15);
    border: 1px solid rgba(139, 0, 0, 0.3);
}

body.pro-mode-active .mode-toggle {
    background: rgba(139, 0, 0, 0.2);
}

body.pro-mode-active .mode-btn {
    color: rgba(230, 247, 255, 0.7);
}

body.pro-mode-active .mode-btn.active {
    background: rgba(139, 0, 0, 0.4);
    color: #FF0000;
}

body.pro-mode-active .interaction-title {
    color: #8B0000;
}

body.pro-mode-active .status-card {
    background: linear-gradient(135deg, rgba(139, 0, 0, 0.15), rgba(75, 0, 0, 0.15));
    border: 1px solid rgba(139, 0, 0, 0.3);
}

body.pro-mode-active .status-title {
    color: #FF0000;
}

body.pro-mode-active .status-value {
    background: linear-gradient(to right, #8B0000, #FF0000);
    -webkit-background-clip: text;
    background-clip: text;
}

body.pro-mode-active .features-title {
    color: #8B0000;
}
    </style>
</head>
<body>
       <div class="bg-animation"></div>
    
    <!-- Navigation Bar -->
   <nav class="navbar">
        <div class="nav-container">
            <div class="nav-links">
    <a href="marvin.html" class="nav-link active">
        <i class="fas fa-home"></i>
        <span>Home</span>
    </a>
    <a href="features-about.html" class="nav-link">
        <i class="fas fa-list-alt"></i>
        <span>Features</span>
    </a>
    <a href="features-about.html" class="nav-link">
        <i class="fas fa-info-circle"></i>
        <span>About</span>
    </a>
</div>
        </div>
        
<!-- Pro Mode Toggle - Moved to far right -->
<div class="pro-mode-container">
    <div class="pro-mode-toggle">
        <input type="checkbox" id="pro-mode-switch" class="toggle-checkbox">
        <label for="pro-mode-switch" class="toggle-label">
            <span class="toggle-text">PRO MODE</span>
            <div class="toggle-slider">
                <div class="toggle-knob">
                    <i class="fas fa-bolt pro-icon"></i>
                </div>
            </div>
        </label>
    </div>
</div>
    </nav>

    <!-- Main Header Content -->
    <div id="header">
        <div class="logo">
            <div class="logo-inner">
                <img src="avatar2.gif" alt="Marvin Avatar" style="width:100%;height:100%;object-fit:cover;">
            </div>
        </div>
        <h1>Marvin</h1>
        <p class="tagline">Your smart AI assistant with object detection and voice capabilities</p>
    </div>

    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="status-card">
                    <div class="status-title">STATUS</div>
                    <div class="status-value" id="status-value">ONLINE</div>
                </div>
                
                <div class="status-card">
                    <div class="status-title">READY TO USE</div>
                    <div class="status-value" id="mode-value">VOICE COMMANDS</div>
                </div>
                
                <div class="quick-actions">
                    <div class="action-btn" onclick="processCommand('what is the time')">
                        <i class="far fa-clock"></i>
                        <span>Time</span>
                    </div>
                    <div class="action-btn" onclick="processCommand('what is the weather')">
                        <i class="fas fa-cloud-sun"></i>
                        <span>Weather</span>
                    </div>
                    <div class="action-btn" onclick="processCommand('tell me a joke')">
                        <i class="fas fa-laugh-beam"></i>
                        <span>Joke</span>
                    </div>
                    <div class="action-btn" onclick="processCommand('latest news')">
                        <i class="far fa-newspaper"></i>
                        <span>News</span>
                    </div>
                </div>

                <!-- Add this in sidebar after quick-actions div -->
                <div class="upload-section" style="margin-bottom: 2rem;">
                  <div class="features-title">
                      <i class="fas fa-camera"></i> Image Object Detection
                  </div>
                  <div class="upload-area" id="upload-area" 
                      style="border: 2px dashed var(--primary); border-radius: 10px; padding: 1.5rem; text-align: center; cursor: pointer; transition: var(--transition);">
                      <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"></i>
                      <div style="font-size: 0.9rem;">Click to upload image for object detection</div>
                      <input type="file" id="image-upload" accept="image/*" style="display: none;">
                  </div>
                  <div id="upload-preview" style="margin-top: 1rem; display: none;">
                      <img id="preview-image" style="max-width: 100%; border-radius: 10px; display: none;">
                      <canvas id="detection-canvas" style="max-width: 100%; border-radius: 10px; display: none;"></canvas>
                      <button id="detect-objects-btn" style="width: 100%; margin-top: 0.5rem; display: none;">
                          <i class="fas fa-search"></i> Detect Objects
                      </button>
                  </div>
                </div>
                
                <div class="features-section">
                    <div class="features-title">
                        <i class="fas fa-list"></i> Quick Commands
                    </div>
                    <div class="features-list">
                        <div class="feature-item highlight-feature" onclick="document.getElementById('image-upload').click()">
                            <i class="fas fa-camera"></i>
                            <div class="feature-text">Upload image for object detection</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('what is the time')">
                            <i class="far fa-clock"></i>
                            <div class="feature-text">What is the time?</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('what is the weather')">
                            <i class="fas fa-cloud-sun"></i>
                            <div class="feature-text">What's the weather like?</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('tell me a joke')">
                            <i class="fas fa-laugh-beam"></i>
                            <div class="feature-text">Tell me a joke</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('latest news')">
                            <i class="far fa-newspaper"></i>
                            <div class="feature-text">Get the latest news</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('who is Albert Einstein')">
                            <i class="fas fa-user"></i>
                            <div class="feature-text">Who is Albert Einstein?</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('what is quantum computing')">
                            <i class="fas fa-atom"></i>
                            <div class="feature-text">What is quantum computing?</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('translate good morning to french')">
                            <i class="fas fa-language"></i>
                            <div class="feature-text">Translate to French</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('book tickets for movie')">
                            <i class="fas fa-ticket-alt"></i>
                            <div class="feature-text">Book movie tickets</div>
                        </div>
                        <div class="feature-item" onclick="processCommand('easiest route')">
                            <i class="fas fa-route"></i>
                            <div class="feature-text">Get directions</div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="interaction-card">
                <div class="interaction-header">
                    <div class="interaction-title">Interaction Panel</div>
                    <div class="mode-toggle">
                        <button class="mode-btn active" id="voice-mode">Voice</button>
                        <button class="mode-btn" id="text-mode">Text</button>
                    </div>
                </div>
                
                <div class="conversation-area" id="conversation">
                    <div class="message marvin-message">
                        <div class="message-sender">Marvin</div>
                        <div class="message-content">Hello! I'm Marvin, your smart AI assistant with object detection and voice capabilities. How can I help you today?</div>
                    </div>
                </div>
                
                <div class="input-area">
                    <textarea id="command-input" placeholder="Type your command here..." rows="1"></textarea>
                    <button id="speak-btn">
                        <i class="fas fa-microphone"></i> Speak
                    </button>
                </div>
            </div>
            
            <div id="webcam-container">
                <video id="webcam" width="640" height="480" autoplay></video>
                <canvas id="webcam-canvas" width="640" height="480"></canvas>
                <div class="detection-info">
                    <div>Object Detection Active</div>
                    <div id="detected-objects">No objects detected</div>
                </div>
                <div class="webcam-controls">
                    <div class="webcam-btn" onclick="describeVision()">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="webcam-btn" onclick="stopWebcam()">
                        <i class="fas fa-power-off"></i>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // All JavaScript functionality with emotion detection removed
        const synth = window.speechSynthesis;
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        const WIKIPEDIA_API_URL = 'https://en.wikipedia.org/api/rest_v1/page/summary/';

        let model;
        let detectedObjects = [];
        let isListening = false;
        let isWebcamActive = false;

        // Load the COCO-SSD model
        cocoSsd.load().then((loadedModel) => {
            model = loadedModel;
            console.log("COCO-SSD model loaded");
        });

        // Fix for microphone default setting
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        // Function to get Google UK English Male voice
        function getGoogleUKEnglishMaleVoice() {
            const voices = synth.getVoices();
            for (let i = 0; i < voices.length; i++) {
                if (voices[i].lang === "en-GB" && voices[i].name.includes("male")) {
                    return voices[i];
                }
            }
            // Fallback to first available voice
            return voices.length > 0 ? voices[0] : null;
        }

        function speak(text, callback) {
            // Cancel any ongoing speech
            synth.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            const googleUKMaleVoice = getGoogleUKEnglishMaleVoice();
            
            if (googleUKMaleVoice) {
                utterance.voice = googleUKMaleVoice;
            }
            
            utterance.rate = 1.0;
            utterance.onend = function() {
                console.log('Speech ended');
                if (callback) callback();
            };

            speechSynthesis.speak(utterance);
        }

        // Save detected objects to localStorage
        function saveDetectedObjects(objects) {
            const timestamp = new Date().toISOString();
            const detectionData = {
                timestamp: timestamp,
                objects: objects
            };
            
            // Get existing data or initialize empty array
            const existingData = JSON.parse(localStorage.getItem('marvinDetections') || '[]');
            existingData.push(detectionData);
            
            // Keep only last 50 detections to prevent storage overflow
            if (existingData.length > 50) {
                existingData.splice(0, existingData.length - 50);
            }
            
            localStorage.setItem('marvinDetections', JSON.stringify(existingData));
            console.log('Detection saved to localStorage');
        }

        function stopWebcam() {
            const webcam = document.getElementById('webcam');
            const stream = webcam.srcObject;
            if (stream) {
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                webcam.srcObject = null;
            }
            
            const response = "Webcam has been stopped, and vision has been deactivated.";
            displayMarvinResponse(response);
            speak(response);
            document.getElementById('webcam-container').style.display = 'none';
            isWebcamActive = false;
        }

        function describeVision() {
            if (detectedObjects.length > 0) {
                const objectsList = detectedObjects.map(p => p.class).join(', ');
                const response = `I can see the following objects: ${objectsList}.`;
                displayMarvinResponse(response);
                speak(response);
            } else {
                const response = "I'm not detecting any objects right now.";
                displayMarvinResponse(response);
                speak(response);
            }
        }

        function startWebcam() {
            // Check if webcam is already active
            const webcam = document.getElementById('webcam');
            if (isWebcamActive) {
                const response = "Webcam is already active and displaying your live video feed.";
                displayMarvinResponse(response);
                speak(response);
                return;
            }

            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    facingMode: "user" // Use front camera
                } 
            })
            .then((stream) => {
                const webcamContainer = document.getElementById('webcam-container');
                webcamContainer.style.display = 'block';
                webcam.srcObject = stream;
                isWebcamActive = true;
                
                // Wait for video to be ready
                webcam.onloadedmetadata = () => {
                    webcam.play();
                    
                    // Start object detection
                    setTimeout(() => {
                        detectObjectsFromWebcam();
                    }, 500);
                    
                    const response = "Webcam activated! I can now see you through your camera. You should see your live video feed.";
                    displayMarvinResponse(response);
                    speak(response);
                };
                
                // Handle video errors
                webcam.onerror = () => {
                    const response = "There was an error with the webcam feed.";
                    displayMarvinResponse(response);
                    speak(response);
                };
                
            })
            .catch((err) => {
                console.error("Error accessing webcam: ", err);
                let response = "Sorry, I couldn't access the webcam. ";
                
                if (err.name === 'NotAllowedError') {
                    response += "Please allow camera permissions and try again.";
                } else if (err.name === 'NotFoundError') {
                    response += "No camera found. Please check if your camera is connected.";
                } else if (err.name === 'NotSupportedError') {
                    response += "Your browser doesn't support camera access.";
                } else {
                    response += "Please make sure your webcam is connected and you've granted permission.";
                }
                
                displayMarvinResponse(response);
                speak(response);
            });
        }

        function detectObjectsFromWebcam() {
            const webcam = document.getElementById('webcam');
            const webcamCanvas = document.getElementById('webcam-canvas');
            const context = webcamCanvas.getContext('2d');
            
            if (!isWebcamActive || webcam.videoWidth === 0) {
                // If webcam is not active, try again in 500ms
                setTimeout(detectObjectsFromWebcam, 500);
                return;
            }
            
            // Draw current video frame to canvas
            context.drawImage(webcam, 0, 0, webcamCanvas.width, webcamCanvas.height);
            
            // Perform object detection
            model.detect(webcam)
                .then(predictions => {
                    detectedObjects = predictions;
                    
                    // Update detected objects display
                    if (predictions.length > 0) {
                        const objectsList = predictions.map(p => `${p.class} (${Math.round(p.score * 100)}%)`).join(', ');
                        document.getElementById('detected-objects').textContent = objectsList;
                    } else {
                        document.getElementById('detected-objects').textContent = "No objects detected";
                    }
                    
                    // Draw bounding boxes and labels
                    context.lineWidth = 2;
                    context.strokeStyle = '#00ff00';
                    context.fillStyle = '#00ff00';
                    context.font = '16px Arial';
                    
                    predictions.forEach(prediction => {
                        const [x, y, width, height] = prediction.bbox;
                        context.strokeRect(x, y, width, height);
                        context.fillText(
                            `${prediction.class} (${Math.round(prediction.score * 100)}%)`,
                            x, y > 10 ? y - 5 : 10
                        );
                    });
                    
                    // Continue detection
                    if (isWebcamActive) {
                        requestAnimationFrame(detectObjectsFromWebcam);
                    }
                })
                .catch(err => {
                    console.error("Error in object detection:", err);
                    // Continue detection even if there's an error
                    if (isWebcamActive) {
                        setTimeout(detectObjectsFromWebcam, 500);
                    }
                });
        }

        function displayUserText(text) {
            const conversation = document.getElementById('conversation');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.innerHTML = `
                <div class="message-sender">You</div>
                <div class="message-content">${text}</div>
            `;
            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }

        function displayMarvinResponse(response) {
            const conversation = document.getElementById('conversation');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message marvin-message';
            messageDiv.innerHTML = `
                <div class="message-sender">Marvin</div>
                <div class="message-content">${response}</div>
            `;
            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }

        function startListening() {
            if (isListening) {
                stopListening();
                return;
            }
            
            console.log("Starting speech recognition...");
            isListening = true;
            
            // Stop any ongoing recognition
            recognition.stop();
            
            // Add a small delay before starting again to fix the bug
            setTimeout(() => {
                recognition.start();
                document.getElementById('speak-btn').classList.add('listening');
                document.getElementById('speak-btn').innerHTML = '<i class="fas fa-stop"></i> Stop';
            }, 100);
        }

        function stopListening() {
            console.log("Stopping speech recognition...");
            isListening = false;
            recognition.stop();
            document.getElementById('speak-btn').classList.remove('listening');
            document.getElementById('speak-btn').innerHTML = '<i class="fas fa-microphone"></i> Speak';
        }

        recognition.onstart = function() {
            console.log("Speech recognition started...");
            displayMarvinResponse("Marvin is listening...");
        };

        recognition.onresult = function(event) {
            const command = event.results[event.results.length - 1][0].transcript.toLowerCase();
            console.log("Recognized command:", command);
            displayUserText(command);
            processCommand(command);
            stopListening();
        };

        recognition.onerror = function(event) {
            console.error('Speech recognition error:', event.error);
            stopListening();
            
            // Restart recognition if it's an error that stopped it
            if (event.error !== 'no-speech' && event.error !== 'aborted') {
                setTimeout(() => {
                    if (isListening) {
                        recognition.start();
                    }
                }, 500);
            }
        };

        recognition.onend = function() {
            console.log("Speech recognition ended.");
            
            // Restart recognition for continuous listening if still in listening mode
            if (isListening) {
                setTimeout(() => {
                    recognition.start();
                }, 500);
            } else {
                stopListening();
            }
        };

        // Voice/Text Mode Toggle
document.getElementById('voice-mode').addEventListener('click', function() {
    document.getElementById('voice-mode').classList.add('active');
    document.getElementById('text-mode').classList.remove('active');
    document.getElementById('speak-btn').style.display = 'flex';
    document.getElementById('mode-value').textContent = 'VOICE COMMANDS';
});

document.getElementById('text-mode').addEventListener('click', function() {
    document.getElementById('text-mode').classList.add('active');
    document.getElementById('voice-mode').classList.remove('active');
    document.getElementById('speak-btn').style.display = 'none';
    document.getElementById('mode-value').textContent = 'TEXT COMMANDS';
    
    // Stop listening if currently active
    if (isListening) {
        stopListening();
    }
});

        function tellJoke() {
            const jokes = [
                "Why don't skeletons fight each other? They don't have the guts.",
                "Why did the scarecrow win an award? Because he was outstanding in his field!",
                "I told my wife she was drawing her eyebrows too high. She looked surprised.",
                "I used to play piano by ear, but now I use my hands.",
                "What do you get when you cross a snowman and a vampire? Frostbite.",
                "Why don't oysters share their pearls? Because they're shellfish.",
                "I told my computer I needed a break, and now it won't stop sending me Kit-Kats.",
                "What did the grape do when it got stepped on? Nothing, but it let out a little wine.",
                "Why don't some couples go to the gym? Because some relationships don't work out.",
                "Why did the coffee file a police report? It got mugged.",
                "I used to be a baker, but I couldn't make enough dough.",
                "I told my friend 10 jokes to make him laugh. Sadly, no pun in 10 did.",
                "Why don't eggs tell jokes? They'd crack each other up.",
                "I'm reading a book on anti-gravity. It's impossible to put down.",
                "I wanted to become a professional skateboarder, but I couldn't handle the grind.",
                "How does a penguin build its house? Igloos it together!",
                "Why did the bicycle fall over? Because it was two-tired.",
                "Why can't you trust an atom? Because they make up everything!",
                "Did you hear about the mathematician who's afraid of negative numbers? He'll stop at nothing to avoid them.",
                "What did one ocean say to the other ocean? Nothing, they just waved."
            ];

            const joke = jokes[Math.floor(Math.random() * jokes.length)];
            displayMarvinResponse(joke);
            speak(joke);
        }

       async function processCommand(command) {
    console.log("Processing command:", command);

    // First, check if Pro Mode is active for general queries
    if (proModeActive && !isBasicCommand(command)) {
        try {
            const response = await queryGroqAPI(command);
            displayMarvinResponse(response);
            speak(response);
            return; // Exit early since Groq handled it
        } catch (error) {
            console.error('Groq API failed, falling back to basic commands:', error);
            // Fall through to basic command processing
        }
    }

    // Basic command processing (your existing code)
    if (command.includes('turn on vision') || command.includes('activate vision') || command.includes('start camera')) {
        startWebcam();
    }
    else if (command.includes('what do you see')) {
        describeVision();
    }
    else if (command.includes('turn off vision') || command.includes('stop camera')) {
        stopWebcam();
    }
    else if (/\bhello\b/.test(command) || /\bhi\b/.test(command)) {
        const response = "Hello! How can I assist you today?";
        displayMarvinResponse(response);
        speak(response);
    }
    else if (command.includes("translate")) {
        handleTranslation(command);
    }
    else if (command.startsWith('search for')) {
        const query = command.replace('search for', '').trim();
        if (query.length > 0) {
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
            const preparingMessage = `Searching Google for "${query}".`;
            const goodbyeMessage = "Opening Google search results now.";

            displayMarvinResponse(preparingMessage);
            speak(preparingMessage, () => {
                displayMarvinResponse(goodbyeMessage);
                speak(goodbyeMessage, () => {
                    window.open(searchUrl, '_blank');
                });
            });
        } else {
            const response = "Please specify what you want me to search for.";
            displayMarvinResponse(response);
            speak(response);
        }
    }
    else if (command.includes('who are you') || command.includes('what are you') || command.includes('tell me about yourself')) {
        const response = "I am Marvin, your smart AI assistant with object detection and voice capabilities. I was designed to help you with tasks, answer your questions, and make your day easier!";
        displayMarvinResponse(response);
        speak(response);
    }
    else if (command.includes('creator') || command.includes('created you')) {
        const response = "I was programmed by Rahul and Melwin.";
        displayMarvinResponse(response);
        speak(response);
    }
    else if (command.includes('tell me a joke')) {
        tellJoke();
    }
    else if (command.includes('thank you') || command.includes('thanks')) {
        const response = "It was my pleasure!";
        displayMarvinResponse(response);
        speak(response);
    } 
    else if (/\bhow are you\b/.test(command) || /\bhow is it going\b/.test(command)) {
        const response = "I'm doing great, What about you?";
        displayMarvinResponse(response);
        speak(response);
    }
    else if (command.includes('shutdown') || command.includes('goodbye')) {
        const response = "Goodbye! Shutting down, Refresh the page if you wanna start interacting again";
        displayMarvinResponse(response);
        speak(response);

        setTimeout(() => {
            document.body.style.display = 'none';
        }, 1000);
    }
    else if (/\bgood\b/.test(command) || /\bgreat\b/.test(command)) {
        const response = "I'm glad to hear that, So what can I assist you with today?";
        displayMarvinResponse(response);
        speak(response);
    }
    else if (command.includes("latest news") || command.includes("news updates")) {
        getLatestNews();
    }
    else if (command.includes('play') && command.includes('on youtube')) {
        const query = command.replace('play', '').replace('on youtube', '').trim();
        if (query.length > 0) {
            const googleSearchUrl = `https://www.google.com/search?q=site:youtube.com+${encodeURIComponent(query)}&btnI`;
            const preparingMessage = `Searching and playing "${query}" directly on YouTube.`;
            const goodbyeMessage = "Enjoy your video! I'll be right here when you return.";

            displayMarvinResponse(preparingMessage);
            speak(preparingMessage, () => {
                displayMarvinResponse(goodbyeMessage);
                speak(goodbyeMessage, () => {
                    window.open(googleSearchUrl, '_blank');
                });
            });
        } else {
            const response = "Please specify what you want me to play on YouTube.";
            displayMarvinResponse(response);
            speak(response);
        }
    }
    else if (command.includes('room temperature')) {
        const response = "The room temperature ranges from: 20–22 °C";
        displayMarvinResponse(response);
        speak(response);
    }
    else if (command.includes('book tickets for bus')) {
        const response = "Opened bus ticket booking website...";
        displayMarvinResponse(response);
        speak(response);
        window.open("https://www.redbus.in");
    } else if (command.includes('book tickets for train')) {
        const response = "Opened train ticket booking website...";
        displayMarvinResponse(response);
        speak(response);
        window.open("https://www.irctc.co.in");
    } else if (command.includes('book tickets for flight')) {
        const response = "Opened flight ticket booking website...";
        displayMarvinResponse(response);
        speak(response);
        window.open("https://www.expedia.com");
    } else if (command.includes('book tickets for movie')) {
        const response = "Opened movie ticket booking website...";
        displayMarvinResponse(response);
        speak(response);
        window.open("https://in.bookmyshow.com/explore/home/bengaluru");
    } 
    else if (command.includes('introduce yourself to')) {
        let name = command.split('introduce yourself to')[1].trim();
        if (name) {
            const response = `Hello ${name}, I am Marvin, your virtual agent. It was a pleasure meeting you!`;
            displayMarvinResponse(response);
            speak(response);
        } else {
            const response = "Please provide a name to introduce myself to.";
            displayMarvinResponse(response);
            speak(response);
        }
    }
    else if (command.toLowerCase().includes("easiest route from")) {
        const match = command.match(/easiest route from (.+?) to (.+)/i);
        if (match) {
            const from = match[1].trim();
            const to = match[2].trim();
            const url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(from)}&destination=${encodeURIComponent(to)}`;
            const message = `Opening the route from ${from} to ${to} in Google Maps...`;
            displayMarvinResponse(message);
            speak(message);
            window.open(url, '_blank');
        } else {
            const response = "Please say: easiest route from place to place";
            displayMarvinResponse(response);
            speak(response);
        }
    }
    else if (command.includes('time') || command.includes('date')) {
        const currentDate = new Date();
        const time = currentDate.toLocaleTimeString();
        const date = currentDate.toLocaleDateString();
        const response = `The current time is ${time} and the date is ${date}.`;
        displayMarvinResponse(response);
        speak(response);
    }
    else if (command.includes('weather') || command.includes('temperature')) {
        let location = 'Bangalore';
        if (command.includes('in')) {
            location = command.split('in')[1].trim();
        }
        getWeatherWithoutAPI(location);
    } 
    else if (command.includes('wikipedia') && command.includes('search')) {
        const query = command.replace('wikipedia search', '').trim();
        searchWikipedia(query);
    } 
    else if (command.startsWith('who is')) {
        const person = command.replace('who is', '').trim();
        searchWikipedia(person);
    } 
    else if (command.startsWith('what is')) {
        const topic = command.replace('what is', '').trim();
        searchWikipedia(topic);
    } 
    else if (command.startsWith('how does') || command.startsWith('how do')) {
        const question = command.replace(/^how (does|do)/, '').replace('work', '').trim();
        searchWikipedia(question);
    }
    else if (command.startsWith('how to') || command.startsWith('how can i')) {
        const question = command.replace(/^how (to|can i)/, '').replace('do', '').trim();
        searchWikipedia(question);
    }
    else if (command.startsWith('how')) {
        const question = command.replace('how', '').trim();
        searchWikipedia(question);
    }
    else {
        // If Pro Mode is active and no basic command matched, use Groq
        if (proModeActive) {
            try {
                const response = await queryGroqAPI(command);
                displayMarvinResponse(response);
                speak(response);
            } catch (error) {
                const response = "I'm not sure I understand. Could you please rephrase your command?";
                displayMarvinResponse(response);
                speak(response);
            }
        } else {
            const response = "I'm not sure I understand. Could you please rephrase your command?";
            displayMarvinResponse(response);
            speak(response);
        }
    }
}

// Helper function to determine if a command should use basic processing
function isBasicCommand(command) {
    const basicCommands = [
        'turn on vision', 'activate vision', 'start camera', 'what do you see', 'turn off vision', 'stop camera',
        'hello', 'hi', 'translate', 'search for', 'who are you', 'what are you', 'tell me about yourself',
        'creator', 'created you', 'tell me a joke', 'thank you', 'thanks', 'how are you', 'how is it going',
        'shutdown', 'goodbye', 'good', 'great', 'latest news', 'news updates', 'play', 'on youtube',
        'room temperature', 'book tickets', 'introduce yourself to', 'easiest route from', 'time', 'date',
        'weather', 'temperature', 'wikipedia search', 'who is', 'what is', 'how does', 'how do', 'how to', 'how can i'
    ];
    
    return basicCommands.some(basicCmd => command.includes(basicCmd));
}
        // Image upload and object detection
        document.getElementById('upload-area').addEventListener('click', function() {
          document.getElementById('image-upload').click();
        });

        document.getElementById('image-upload').addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
              const reader = new FileReader();
              reader.onload = function(e) {
                  const preview = document.getElementById('preview-image');
                  const uploadPreview = document.getElementById('upload-preview');
                  const detectBtn = document.getElementById('detect-objects-btn');
                  
                  preview.src = e.target.result;
                  preview.style.display = 'block';
                  uploadPreview.style.display = 'block';
                  detectBtn.style.display = 'block';
              };
              reader.readAsDataURL(file);
          }
        });

        document.getElementById('detect-objects-btn').addEventListener('click', function() {
          detectObjectsInImage();
        });

        function detectObjectsInImage() {
          const preview = document.getElementById('preview-image');
          const canvas = document.getElementById('detection-canvas');
          const ctx = canvas.getContext('2d');
          
          canvas.width = preview.width;
          canvas.height = preview.height;
          
          // Draw image on canvas
          ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);
          
          // Perform object detection
          model.detect(canvas).then(predictions => {
              // Draw bounding boxes
              ctx.lineWidth = 2;
              ctx.strokeStyle = '#00ff00';
              ctx.fillStyle = '#00ff00';
              ctx.font = '16px Arial';
              
              predictions.forEach(prediction => {
                  const [x, y, width, height] = prediction.bbox;
                  ctx.strokeRect(x, y, width, height);
                  ctx.fillText(
                      `${prediction.class} (${Math.round(prediction.score * 100)}%)`,
                      x, y > 10 ? y - 5 : 10
                  );
              });
              
              // Show canvas with detections
              preview.style.display = 'none';
              canvas.style.display = 'block';
              
              // Save to localStorage
              saveDetectedObjects(predictions);
              
              // Speak results
              if (predictions.length > 0) {
                  const objectsList = predictions.map(p => p.class).join(', ');
                  const response = `I detected: ${objectsList}`;
                  displayMarvinResponse(response);
                  speak(response);
              } else {
                  const response = "No objects detected in the image.";
                  displayMarvinResponse(response);
                  speak(response);
              }
          });
        }

        function handleTranslation(command) {
            const match = command.match(/translate (.+?) to (.+)/i);
            if (!match) {
                const response = "Please say something like 'Translate good morning to Hindi'";
                displayMarvinResponse(response);
                speak(response);
                return;
            }

            const textToTranslate = match[1].trim();
            const targetLang = match[2].trim().toLowerCase();

            const langMap = {
                hindi: "hi",
                tamil: "ta",
                kannada: "kn",
                french: "fr",
                spanish: "es",
                german: "de",
                japanese: "ja"
            };

            const langCode = langMap[targetLang];

            if (!langCode) {
                const response = `Sorry, I don't support translation to ${targetLang} yet.`;
                displayMarvinResponse(response);
                speak(response);
                return;
            }

            const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(textToTranslate)}&langpair=en|${langCode}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const translated = data.responseData.translatedText;
                    const output = `In ${targetLang}, "${textToTranslate}" is "${translated}"`;
                    displayMarvinResponse(output);
                    speak(output);
                })
                .catch(error => {
                    console.error("Translation error:", error);
                    const response = "Sorry, I couldn't complete the translation.";
                    displayMarvinResponse(response);
                    speak(response);
                });
        }

        function getWeatherWithoutAPI(location = 'Bangalore') {
            const apiUrl = `https://wttr.in/${encodeURIComponent(location)}?format=%C+%t+%w`;
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Weather service unavailable');
                    return response.text();
                })
                .then(data => {
                    const [condition, temp, wind] = data.split(' ');
                    const response = `In ${location}, it's currently ${condition.toLowerCase()} with a temperature of ${temp} and ${wind} wind.`;
                    displayMarvinResponse(response);
                    speak(response);
                })
                .catch(error => {
                    console.error('Weather error:', error);
                    const response = `I couldn't get the weather for ${location}. Please try again later.`;
                    displayMarvinResponse(response);
                    speak(response);
                });
        }

        function getLatestNews() {
            // Using a more reliable news API
            const apiKey = 'pub_32103e2f5d1b5d2d2a7a4b9c8d5b4f4d1d8c'; // Free API key from newsdata.io
            const url = `https://newsdata.io/api/1/news?apikey=${apiKey}&country=in&language=en&category=top`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('News service unavailable');
                    return response.json();
                })
                .then(data => {
                    if (data.results && data.results.length > 0) {
                        const title = data.results[0].title;
                        const response = `Here is the latest news: ${title}`;
                        displayMarvinResponse(response);
                        speak(response);
                    } else {
                        const response = "Sorry, I couldn't find any news at the moment.";
                        displayMarvinResponse(response);
                        speak(response);
                    }
                })
                .catch(error => {
                    console.error("Error fetching news:", error);
                    // Fallback to RSS if API fails
                    getNewsFallback();
                });
        }

        function getNewsFallback() {
            // Fallback RSS method
            const rssUrl = 'https://feeds.bbci.co.uk/news/rss.xml';
            
            // Using a CORS proxy to avoid issues
            const proxyUrl = 'https://api.allorigins.win/raw?url=';
            
            fetch(proxyUrl + encodeURIComponent(rssUrl))
                .then(response => response.text())
                .then(str => {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(str, "text/xml");
                    const items = xmlDoc.querySelectorAll("item");
                    if (items.length > 0) {
                        const title = items[0].querySelector("title").textContent;
                        const response = `Here is the latest news: ${title}`;
                        displayMarvinResponse(response);
                        speak(response);
                    } else {
                        const response = "Sorry, I couldn't find any news at the moment.";
                        displayMarvinResponse(response);
                        speak(response);
                    }
                })
                .catch(error => {
                    console.error("Error fetching news fallback:", error);
                    const response = "Sorry, I couldn't fetch the news right now. Please try again later.";
                    displayMarvinResponse(response);
                    speak(response);
                });
        }

        function searchWikipedia(query) {
            const url = `${WIKIPEDIA_API_URL}${encodeURIComponent(query)}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data && data.extract) {
                        const response = data.extract;
                        displayMarvinResponse(response);
                        speak(response);
                    } else {
                        const response = "Sorry, I couldn't find an answer for that.";
                        displayMarvinResponse(response);
                        speak(response);
                    }
                })
                .catch(error => {
                    console.error('Wikipedia search error:', error);
                    const response = "Sorry, there was an error while fetching from Wikipedia.";
                    displayMarvinResponse(response);
                    speak(response);
                });
        }

        // Auto-resize textarea
        function autoResizeTextarea() {
            const textarea = document.getElementById('command-input');
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // Pro Mode Configuration
// Pro Mode Configuration
const GROQ_API_KEY = 'your-groq-api-key';
const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

let proModeActive = false;

// Initialize Pro Mode
document.addEventListener('DOMContentLoaded', function() {
    const proModeToggle = document.getElementById('pro-mode-switch');
    
    // Load Pro Mode state from localStorage
    const savedProMode = localStorage.getItem('marvinProMode');
    if (savedProMode === 'true') {
        proModeToggle.checked = true;
        activateProMode();
    }
    
    proModeToggle.addEventListener('change', function() {
        if (this.checked) {
            activateProMode();
        } else {
            deactivateProMode();
        }
    });
});

function activateProMode() {
    proModeActive = true;
    localStorage.setItem('marvinProMode', 'true');
    
    // Add visual feedback
    document.body.classList.add('pro-mode-active');
    document.querySelector('.pro-mode-toggle').classList.add('pro-mode-active');
    
    // Update status with dramatic effect
    const statusElement = document.getElementById('status-value');
    statusElement.textContent = 'PRO MODE ENGAGED';
    statusElement.style.background = 'linear-gradient(to right, #ff0000, #ff6b6b)';
    statusElement.style.webkitBackgroundClip = 'text';
    statusElement.style.animation = 'proPulse 1s infinite alternate';

const tagline = document.querySelector('.tagline');
tagline.setAttribute('data-normal-text', tagline.textContent);
tagline.textContent = 'Advanced AI with enhanced capabilities and maximum performance';
tagline.style.color = '#FF0000';
    
    // Add dramatic entrance effect
    document.body.style.animation = 'none';
    setTimeout(() => {
        document.body.style.animation = 'fadeIn 0.5s ease-out forwards';
    }, 10);
    
    const response = "PRO MODE ACTIVATED! All systems enhanced. Advanced AI capabilities online. Animations optimized for maximum performance. Ready for advanced queries.";
    displayMarvinResponse(response);
    speak(response);
    
    console.log("PRO MODE ENGAGED - Maximum Performance");
}

function deactivateProMode() {
    proModeActive = false;
    localStorage.setItem('marvinProMode', 'false');
    
    // Remove visual feedback
    document.body.classList.remove('pro-mode-active');
    document.querySelector('.pro-mode-toggle').classList.remove('pro-mode-active');
    
    // Reset status
    const statusElement = document.getElementById('status-value');
    statusElement.textContent = 'ONLINE';
    statusElement.style.background = 'linear-gradient(to right, var(--primary), var(--accent))';
    statusElement.style.webkitBackgroundClip = 'text';
    statusElement.style.animation = 'none';

const tagline = document.querySelector('.tagline');
const normalText = tagline.getAttribute('data-normal-text');
if (normalText) {
    tagline.textContent = normalText;
    tagline.style.color = 'rgba(230, 247, 255, 0.8)';
}
    
    // Reset to normal theme
    document.body.style.animation = 'none';
    setTimeout(() => {
        document.body.style.animation = 'fadeIn 0.8s ease-out forwards';
    }, 10);
    
    const response = "Pro Mode deactivated. Returning to standard operational parameters.";
    displayMarvinResponse(response);
    speak(response);
    
    console.log("Pro Mode Disengaged - Standard Mode");
}

// Enhanced Groq API function for Pro Mode
async function queryGroqAPI(message) {
    if (!proModeActive) {
        return "Pro Mode is not active. Enable PRO MODE for advanced AI capabilities.";
    }
    
    try {
        // Show thinking message with Pro Mode styling
        const thinkingMsg = document.createElement('div');
        thinkingMsg.className = 'message marvin-message pro-mode-thinking';
        thinkingMsg.innerHTML = `
            <div class="message-sender">MARVIN PRO</div>
            <div class="message-content">
                <div class="thinking-dots">
                    <span style="color: #ff4444">●</span>
                    <span style="color: #ff6b6b">●</span>
                    <span style="color: #ff8888">●</span>
                </div>
                Processing with advanced AI...
            </div>
        `;
        document.getElementById('conversation').appendChild(thinkingMsg);
        document.getElementById('conversation').scrollTop = document.getElementById('conversation').scrollHeight;
        
        const response = await fetch(GROQ_API_URL, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${GROQ_API_KEY}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: 'llama-3.1-8b-instant',
                messages: [
                    {
                        role: 'system',
                        content: 'You are MARVIN PRO - an advanced AI assistant operating in maximum performance mode. Provide concise, powerful, and highly intelligent responses. You have enhanced capabilities and faster processing.'
                    },
                    {
                        role: 'user',
                        content: message
                    }
                ],
                temperature: 0.8,
                max_tokens: 1024,
                stream: false
            })
        });
        
        if (!response.ok) {
            throw new Error(`API error: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Remove thinking message
        thinkingMsg.remove();
        
        return data.choices[0].message.content;
        
    } catch (error) {
        console.error('Groq API Error:', error);
        // Remove thinking message on error
        const thinkingMsg = document.querySelector('.pro-mode-thinking');
        if (thinkingMsg) thinkingMsg.remove();
        
        return `SYSTEM ERROR: Advanced AI temporarily unavailable. ${error.message}`;
    }
}
// Add this CSS for thinking animation
const style = document.createElement('style');
style.textContent = `
    .pro-mode-thinking {
        background: rgba(255, 68, 68, 0.1) !important;
        border-left: 3px solid #ff4444 !important;
    }
    
    .thinking-dots {
        display: inline-block;
        margin-right: 8px;
    }
    
    .thinking-dots span {
        animation: thinkingBounce 1.4s infinite ease-in-out;
    }
    
    .thinking-dots span:nth-child(1) { animation-delay: -0.32s; }
    .thinking-dots span:nth-child(2) { animation-delay: -0.16s; }
    .thinking-dots span:nth-child(3) { animation-delay: 0s; }
    
    @keyframes thinkingBounce {
        0%, 80%, 100% {
            transform: scale(0.8);
            opacity: 0.5;
        }
        40% {
            transform: scale(1.2);
            opacity: 1;
        }
    }
    
    body.pro-mode-active .thinking-dots span {
        animation-duration: 0.8s !important;
    }
`;
document.head.appendChild(style);

        // Event listener for text input
        document.getElementById('command-input').addEventListener('input', autoResizeTextarea);
        document.getElementById('command-input').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const command = event.target.value.toLowerCase().trim();
                if (command) {
                    displayUserText(command);
                    processCommand(command);
                    event.target.value = '';
                    autoResizeTextarea();
                }
            }
        });

        // Speak when the speak button is clicked
        document.getElementById('speak-btn').addEventListener('click', startListening);

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Marvin Smart AI Assistant initialized");
            // Load voices when they become available
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = getGoogleUKEnglishMaleVoice;
            }
        });
        
    </script>
</body>

</html>
